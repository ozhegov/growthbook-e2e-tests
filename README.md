# Проект по автоматизации тестирования self-hosted версии приложения **[GrowthBook](https://www.growthbook.io/)**

![GrowthBook лого](/docs/images/growthbook-logo.png)

## Быстрый старт

Проект содержит `docker-compose` конфигурацию для локального запуска GrowthBook.
Дополнительная установка приложения не требуется.

```bash
git clone https://github.com/ozhegov/growthbook-e2e-tests.git
cd growthbook-e2e-tests
npm run docker:up
npm install
npm run test:smoke
```

- мок-тесты: `@mock` в названии теста
- роли пользователей: `@role=admin | engineer | experimenter` в названии теста
- отчётность: `npm run allure:report && npm run allure:open`

![Тестовый прогон](/docs/images/test-run.gif)
*Пример прогоня smoke-теста*

---

## Оглавление

1. [Описание проекта](#описание-проекта)
2. [Технологический стек](#технологический-стек)
3. [Структура проекта](#структура-проекта)
4. [Требования для локального запуска](#требования-для-локального-запуска)
5. [Локальный запуск](#локальный-запуск)
6. [Архитектура тестов](#архитектура-тестов)
7. [Использование моков](#использование-моков)
8. [Роли и авторизация](#роли-и-авторизация)
9. [CI / CD и отчётность](#ci--cd-и-отчётность)
10. [Линтинг и контроль качества](#линтинг-и-контроль-качества)

---

## Описание проекта

GrowthBook — приложение с открытым исходным кодом для создания и управления фиче‑флагами и A/B‑экспериментами, которое можно самостоятельно развернуть в своей инфраструктуре.

Основной фокус проекта - фронтенд‑автотесты на **Playwright (TypeScript)** с упором на:
- Тестирование как на реальном бэкенде, так и на моках API
- Масштабируемую архитектуру автотестов
- Контроль качества тестов через кастомные ESLint‑правила
- Стабильную и предсказуемую интеграцию в CI

---

## Технологический стек

- **Playwright** — E2E фронтенд‑тестирование
- **TypeScript** — основной язык проекта
- **Page Object Model (POM)** — архитектура автотестов
- **Docker / Docker Compose** — запуск приложения GrowthBook в своей инфраструктуре
- **Allure Report** — отчёты о тестовых прогонах
- **ESLint + кастомные правила** — контроль качества автотестов
- **Biome** — линтинг и форматирование общего кода
- **Faker** — генерация тестовых данных (с использованием фиксированного seed)
- **GitHub Actions** — CI/CD

---

## Структура проекта

```text
e2e/
├── api/            — API‑методы для подготовки тестовых данных
├── factories/      — фабрики тестовых данных
├── fixtures/       — фикстуры: роли, авторизация, роутинг моков, парсинг тегов
├── helpers/        — утилиты и хелперы для тестов и фикстур
├── mocks/          — изолированные моки API
├── poms/           — Page Object Model (UI‑логика и селекторы)
├── tests/          — тестовые сценарии
├── notifications/  — отправка уведомлений (Telegram)
├── setup/          — подготовка пользователей и контекстов браузера
```

---

## Требования для локального запуска

Для работы с проектом необходимо:

- **Node.js >= 20**
- **npm >= 9**
- **Docker**
- **Docker Compose v2**

---

## Локальный запуск

### 1. Запуск GrowthBook

```bash
npm run docker:up
```

Для остановки и очистки:

```bash
npm run docker:reset
```

---

### 2. Установка зависимостей

```bash
npm install
```

---

### 3. Запуск тестов

- Все тесты:
```bash
npm run test
```

- Smoke тесты:
```bash
npm run test:smoke
```

- Regression тесты:
```bash
npm run test:regression
```
---

## Архитектура тестов

Проект построен с использованием **Page Object Model**.

Дополнительно используются:
- фабрики тестовых данных на базе `faker` с фиксированным seed, обеспечивающим воспроизводимость сценариев (папка `factories`),
- API‑слой для подготовки данных (папка `api`),
- фикстуры для управления окружением, ролями и мок‑логикой (папка `fixtures`).

---

## Использование моков

Мок‑тесты являются основным инструментом проверки фронтенд‑логики.

### Ключевые идеи

- изоляция фронтенда от нестабильного бэкенда;
- быстрый и предсказуемый фидбек в CI;
- возможность тестировать нестандартные кейсы и ошибки.

### Как это работает

- тест помечается тегом `@mock` в названии теста;
- соответствующая фикстура автоматически включает роутинг моков;
- все мок‑ответы хранятся в папке `mocks/`;
- живой бэкенд для таких тестов не требуется.

Пример теста:
- `Старт нового эксперимента @allure.id=122011 @role=experimenter @regression @smoke @mock`.

---

## Роли и авторизация

Тесты поддерживают запуск под разными ролями:

- admin
- engineer
- experimenter

### Как это работает

- роль указывается тегом `@role=` в названии теста;
- хелпер-функция парсит тег из названия и передает полученную роль в фикстуру авторизации;
- фикстура авторизации автоматически подхватывает нужный контекст браузера из сохраненых при выполнении global setup.

### Global Setup

Вся базовая подготовка выполняется в `global setup`:
- регистрация пользователей с основными ролями;
- сохранение их браузерного контекста;
- повторное использование контекстов в тестах.

---

## CI / CD и отчётность

В проекте настроено несколько пайплайнов GitHub Actions:

### E2E Smoke Tests (PR)
- запуск при создании PR
- smoke‑тесты
- быстрый фидбек
- ограниченный набор браузеров

### E2E Full Tests (main)
- запуск при пуше в main 
- полный набор тестов
- ограниченный набор браузеров

### E2E Regression (cron)
- запуск по расписанию регрессионного набора тестов
- все браузеры
- публикация Allure‑отчёта на GitHub Pages
- отправка результатов в Telegram

Отчёт доступен по ссылке:
https://ozhegov.github.io/growthbook-e2e-tests/

![Allure графики](/docs/images/allure_graphs.png)
*Общая статистика прогонов тестов в Allure*

![Allure тест-кейс](/docs/images/allure_test_case.png)
*Детальный отчёт по конкретному тест-кейсу*

---

## Линтинг и контроль качества

### Biome

- линтинг и форматирование общего кода

### ESLint 

- линтинг автотестов (`eslint-plugin-playwright`);
- контроль архитектуры и стиля тестов;
- предотвращение анти‑паттернов.

### Кастомные правила 

В проекте используется не только стандартный линтинг, но и **кастомные ESLint-правила**, которые задают обязательные контракты для автотестов.

#### Правило `require-allure-id`

**Назначение:** Каждый тест должен содержать тег `@allure.id=...` в названии.

**Зачем:**
- гарантирует, что все тесты корректно отображаются в Allure Report;
- обеспечивает однозначную идентификацию тестов между прогонами;
- упрощает анализ флейков, падений и истории запусков;

#### Правило `require-role-tag`

**Назначение:** Каждый тест должен явно указывать роль пользователя через тег `@role=...`.

**Зачем:**
- гарантирует запуск теста в предсказуемом пользовательском контексте;
- предотвращает неявные зависимости от дефолтной роли;
- делает тесты самодокументируемыми;

Кастомные правила реализованы в `eslint/rules`.

### Husky + lint‑staged

- автоматические проверки перед коммитом

**Команды:**

```bash
npm run lint
npm run lint:tests
npm run format
```
---